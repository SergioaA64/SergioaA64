USE db_dwsiasg;

SELECT -- TOP 100
       COUNT(*) registros,
       CJ.DS_ITCP_TP_CRITERIO_JULG Crit_Julg,
       CG.DS_ITCP_IN_COMPRA_GRUPO Cmp_Gru, -- Grupo1 a Grupo10??
       IC.DS_ITCP_ITEM_COMPRA	I_Cmp,
       --IC.DS_ITCP_COMPL_ITEM_COMPRA, IC.DS_ITCP_COMPL_ITEM_COMPRA_CONT -- complemento descrição
       IC.DS_ITCP_UNIDADE_FORNECIMENTO I_Und,
       IC.DS_ITCP_MODELO_VERSAO,
       PPN.DS_ITCP_IN_PREF_PROD_NACIONAL Pref_Nac,
       IC.PE_ITCP_VANT_PROD_NACIONAL [Vant ??], --??
       S.DS_ITCP_IN_SUSTENTAVEL Sustent,
       AD.DS_ITCP_IN_PREF_PROD_ADICIONAL Pref_Adic,
       IC.PE_ITCP_VANT_PROD_ADICIONAL [Vant Adic ??], --??
       TJ.DS_ITCP_IN_TIPO_OBJETO Tipo_Obj,
       CV.DS_ITCP_IN_CRITERIO_VALOR CritVal,
       SG.DS_ITCP_IN_VL_SIGILOSO Vl_Sigilo,
       RED.DS_ITCP_IN_TIPO_REDUCAO Tp_Reduc
       -- IC.*
FROM D_ITCP_ITEM_COMPRA IC
LEFT JOIN D_ITCP_TP_CRITERIO_JULG       CJ  ON CJ.ID_ITCP_TP_CRITERIO_JULG = IC.ID_ITCP_TP_CRITERIO_JULG
LEFT JOIN D_ITCP_IN_COMPRA_GRUPO        CG  ON CG.ID_ITCP_IN_COMPRA_GRUPO = IC.ID_ITCP_IN_COMPRA_GRUPO
LEFT JOIN D_ITCP_IN_PREF_PROD_NACIONAL	 PPN ON PPN.ID_ITCP_IN_PREF_PROD_NACIONAL = IC.ID_ITCP_IN_PREF_PROD_NACIONAL
LEFT JOIN D_ITCP_IN_SUSTENTAVEL	       S   ON S.ID_ITCP_IN_SUSTENTAVEL = IC.ID_ITCP_IN_SUSTENTAVEL
LEFT JOIN D_ITCP_IN_PREF_PROD_ADICIONAL AD  ON AD.ID_ITCP_IN_PREF_PROD_ADICIONAL = IC.ID_ITCP_IN_PREF_PROD_ADICIONAL
LEFT JOIN D_ITCP_IN_TIPO_OBJETO	       TJ  ON TJ.ID_ITCP_IN_TIPO_OBJETO = IC.ID_ITCP_IN_TIPO_OBJETO
LEFT JOIN D_ITCP_IN_CRITERIO_VALOR	    CV  ON CV.ID_ITCP_IN_CRITERIO_VALOR = IC.ID_ITCP_IN_CRITERIO_VALOR
LEFT JOIN D_ITCP_IN_VL_SIGILOSO	       SG  ON SG.ID_ITCP_IN_VL_SIGILOSO = IC.ID_ITCP_IN_VL_SIGILOSO
LEFT JOIN D_ITCP_IN_TIPO_REDUCAO	       RED ON RED.ID_ITCP_IN_TIPO_REDUCAO = IC.ID_ITCP_IN_TIPO_REDUCAO
WHERE TRIM(IC.DS_ITCP_ITEM_COMPRA) LIKE '%CIMENTO PORTL%' 
-- WHERE TRIM(IC.DS_ITCP_ITEM_COMPRA) LIKE 'CANETA ESFERO%'
      --TRIM(IC.DS_ITCP_ITEM_COMPRA) = '"CAFE"' OR
      --IC.DS_ITCP_ITEM_COMPRA LIKE '%CAFE TOR%'
      --IC.ID_ITCP_IN_SUSTENTAVEL = 1 -- sustentável
GROUP BY CJ.DS_ITCP_TP_CRITERIO_JULG,
       CG.DS_ITCP_IN_COMPRA_GRUPO,
       IC.DS_ITCP_ITEM_COMPRA,
       IC.DS_ITCP_UNIDADE_FORNECIMENTO,
       IC.DS_ITCP_MODELO_VERSAO,
       PPN.DS_ITCP_IN_PREF_PROD_NACIONAL,
       IC.PE_ITCP_VANT_PROD_NACIONAL,
       S.DS_ITCP_IN_SUSTENTAVEL,
       AD.DS_ITCP_IN_PREF_PROD_ADICIONAL,
       IC.PE_ITCP_VANT_PROD_ADICIONAL,
       TJ.DS_ITCP_IN_TIPO_OBJETO,
       CV.DS_ITCP_IN_CRITERIO_VALOR,
       SG.DS_ITCP_IN_VL_SIGILOSO,
       RED.DS_ITCP_IN_TIPO_REDUCAO
-- HAVING COUNT(*) > 10000
ORDER BY COUNT(*) DESC;

SELECT -- TOP 100
       COUNT(*) registros,
       CJ.DS_ITCP_TP_CRITERIO_JULG Crit_Julg,
       CG.DS_ITCP_IN_COMPRA_GRUPO Cmp_Gru, -- Grupo1 a Grupo10??
       IC.DS_ITCP_ITEM_COMPRA	I_Cmp,
       IC.DS_ITCP_UNIDADE_FORNECIMENTO I_Und
FROM D_ITCP_ITEM_COMPRA IC
LEFT JOIN D_ITCP_TP_CRITERIO_JULG       CJ  ON CJ.ID_ITCP_TP_CRITERIO_JULG = IC.ID_ITCP_TP_CRITERIO_JULG
LEFT JOIN D_ITCP_IN_COMPRA_GRUPO        CG  ON CG.ID_ITCP_IN_COMPRA_GRUPO = IC.ID_ITCP_IN_COMPRA_GRUPO
WHERE IC.DS_ITCP_ITEM_COMPRA LIKE '%CAFE%'
GROUP BY CJ.DS_ITCP_TP_CRITERIO_JULG,
       CG.DS_ITCP_IN_COMPRA_GRUPO,
       IC.DS_ITCP_ITEM_COMPRA,
       IC.DS_ITCP_UNIDADE_FORNECIMENTO
ORDER BY COUNT(*) DESC;

SELECT COUNT(*) registros,
       IC.DS_ITCP_ITEM_COMPRA	I_Cmp,
       IC.DS_ITCP_UNIDADE_FORNECIMENTO I_Und
FROM D_ITCP_ITEM_COMPRA IC
WHERE TRIM(IC.DS_ITCP_ITEM_COMPRA) LIKE '%CARTUCHO%' AND 
      TRIM(IC.DS_ITCP_ITEM_COMPRA) LIKE '%IMPRE%'
      --(TRIM(IC.DS_ITCP_ITEM_COMPRA) = 'CAFE' OR
      --TRIM(IC.DS_ITCP_ITEM_COMPRA) = '"CAFE"' OR
      --IC.DS_ITCP_ITEM_COMPRA LIKE '%CAFE TOR%') 
      --AND IC.ID_ITCP_IN_SUSTENTAVEL = 1
GROUP BY IC.DS_ITCP_ITEM_COMPRA,
       IC.DS_ITCP_UNIDADE_FORNECIMENTO
-- HAVING COUNT(*) > 10000
ORDER BY COUNT(*) DESC;

FORNECIMENTO / TRANSPORTE DE AGUA - CARRO PIPA
CARTUCHO TONER IMPRESSORA HP
CARTUCHO TINTA IMPRESSORA HP
ASSINATURA DE JORNAIS, REVISTAS E PERIODICOS
CIMENTO PORTLAND

-- D_ITCP_IN_COMPRA_GRUPO
-- D_ITCP_MATERIAL_SERVICO D_MATSERV

WHERE ID_ITCP_TP_COD_MAT_SERV in (1000113026, 1000150375, 1000198960, 1000074365, 2000003697, 1000137499, 1000047686, 1000056154)

F_ItemCompraFornec.ID_ITCP_TP_COD_MAT_SERV

-------------------------------------------------------------------
-- CATEGORIAS DE MATERIAL
-------------------------------------------------------------------

SELECT * 
FROM INFORMATION_SCHEMA.COLUMNS WHERE COLUMN_NAME LIKE '%ITCP_SIT_ATUAL_MAT_SERV%'
order by TABLE_NAME, ORDINAL_POSITION

SELECT MS.ID_ITCP_TP_COD_MAT_SERV,
       MS.DS_ITCP_MATERIAL_SERVICO MatServ,
       TMS.DS_ITCP_TP_MATERIAL_SERVICO Tp_MatServ,
       CMS.ID_ITCP_CLASSE_MAT_SERV,
       CMS.DS_ITCP_CLASSE_MAT_SERV Classe_MatServ,
       S.DS_ITCP_IN_SUSTENTAVEL Sustent,
       SAM.DS_ITCP_SIT_ATUAL_MAT_SERV,
-- MATERIAL
       GM.DS_ITCP_GRUPO_MATERIAL Gr_Mat,
       PDM.DS_ITCP_PADRAO_DESC_MAT PadraoDescMat,
-- SERVIÇO
       GS.DS_ITCP_GRUPO_SERVICO Gr_Serv
FROM   D_ITCP_MATERIAL_SERVICO    MS
LEFT JOIN D_ITCP_TP_MATERIAL_SERVICO TMS ON TMS.ID_ITCP_TP_MATERIAL_SERVICO = MS.ID_ITCP_TP_MATERIAL_SERVICO
LEFT JOIN D_ITCP_GRUPO_MATERIAL      GM  ON GM.ID_ITCP_GRUPO_MATERIAL = MS.ID_ITCP_GRUPO_MATERIAL
LEFT JOIN D_ITCP_PADRAO_DESC_MAT	    PDM ON PDM.ID_ITCP_PADRAO_DESC_MAT = MS.ID_ITCP_PADRAO_DESC_MAT
LEFT JOIN D_ITCP_GRUPO_SERVICO	    GS  ON GS.ID_ITCP_GRUPO_SERVICO = MS.ID_ITCP_GRUPO_SERVICO
LEFT JOIN D_ITCP_CLASSE_MAT_SERV     CMS ON CMS.ID_ITCP_CLASSE_MAT_SERV = MS.ID_ITCP_CLASSE_MAT_SERV
LEFT JOIN D_ITCP_IN_SUSTENTAVEL	    S   ON S.ID_ITCP_IN_SUSTENTAVEL = MS.ID_ITCP_IN_SUSTENTAVEL
LEFT JOIN D_ITCP_SIT_ATUAL_MAT_SERV	 SAM ON SAM.ID_ITCP_SIT_ATUAL_MAT_SERV = MS.ID_ITCP_SIT_ATUAL_MAT_SERV
-- WHERE ID_ITCP_TP_COD_MAT_SERV in (1000113026, 1000150375, 1000198960, 1000074365, 2000003697, 1000047686, 1000056154) -- ex. suco
WHERE MS.ID_ITCP_CLASSE_MAT_SERV = 18955 AND
      MS.DS_ITCP_MATERIAL_SERVICO LIKE '%CAFE%' AND
      (PDM.DS_ITCP_PADRAO_DESC_MAT = 'CAFE' OR
       PDM.DS_ITCP_PADRAO_DESC_MAT = '"CAFE"')




SELECT * FROM D_ITCP_TP_MATERIAL_SERVICO


